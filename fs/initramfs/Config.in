config BR2_TARGET_ROOTFS_INITRAMFS
	bool "initial RAM filesystem linked into linux kernel"
	depends on BR2_LINUX_KERNEL
	help
	  Integrate a cpio archive as an initramfs inside the kernel
	  image. This integration will take place automatically.

if BR2_TARGET_ROOTFS_INITRAMFS

choice
	prompt "Initramfs cpio archive"
	default BR2_INITRAMFS_USE_ROOTFS
	help
	  To accomodate for various scenarios when used for initial
	  RAM filesystem, different options for creation are
	  available.

config BR2_INITRAMFS_USE_ROOTFS
	bool "generate from root filesystem"
	select BR2_TARGET_ROOTFS_CPIO
	help
	  A rootfs.cpio file will be generated in the images/ directory.
	  This is the archive that will be included in the kernel image.
	  The default rootfs compression set in the kernel configuration
	  is used, regardless of how buildroot's cpio archive is configured.

	  Note that enabling initramfs together with another filesystem
	  formats doesn't make sense: you would end up having two
	  identical root filesystems, one embedded inside the kernel
	  image, and one separately.


config BR2_INITRAMFS_USE_OTHER
	bool "generate separately"
	help
	  It is assumed that the cpio archive is generated externally 
	  and will be present at images/rootfs.cpio when it is needed.

	  This option may be used with a post-build hook to generate 
	  and use an initial RAM filesystem that is not the same as
	  root filesystem.

	  The compression options for the cpio archive must be set
	  separately in the kernel configuration according to the 
	  compression used for the externally generated cpio archive.

	  Note that using this option along with cpio archive filesytem
	  target is the same as selecting the "create from root 
	  filesystem" option.
	  
endchoice

choice
	prompt "Compression method"
	default BR2_TARGET_ROOTFS_INITRAMFS_NONE
	help
	  Select compressor for cpio filesystem of the root filesystem.
	  If you use the cpio archive as an initial RAM filesystem, make
	  sure the kernel contains the decompression algorithm selected
	  here.

config BR2_TARGET_ROOTFS_INITRAMFS_NONE
	bool "no compression"
	select BR2_TARGET_ROOTFS_CPIO_NONE if BR2_TARGET_ROOTFS_CPIO
	help
	  Do not compress the cpio filesystem.

config BR2_TARGET_ROOTFS_INITRAMFS_GZIP
	bool "gzip"
	select BR2_TARGET_ROOTFS_CPIO_GZIP if BR2_TARGET_INITRAMFS_USE_ROOTFS
	help
	  Do compress the cpio filesystem with gzip.

config BR2_TARGET_ROOTFS_INITRAMFS_BZIP2
	bool "bzip2"
	select BR2_TARGET_ROOTFS_CPIO_BZIP2 if BR2_TARGET_INITRAMFS_USE_ROOTFS
	help
	  Do compress the cpio filesystem with bzip2.

config BR2_TARGET_ROOTFS_INITRAMFS_LZMA
	bool "lzma"
	select BR2_TARGET_ROOTFS_CPIO_LZMA if BR2_TARGET_INITRAMFS_USE_ROOTFS
	help
	  Do compress the cpio filesystem with lzma.

config BR2_TARGET_ROOTFS_INITRAMFS_LZO
	bool "lzo"
	select BR2_TARGET_ROOTFS_CPIO_LZO if BR2_TARGET_INITRAMFS_USE_ROOTFS
	help
	  Do compress the cpio filesystem with lzop.

config BR2_TARGET_ROOTFS_INITRAMFS_XZ
	bool "xz"
	select BR2_TARGET_ROOTFS_CPIO_XZ if BR2_TARGET_INITRAMFS_USE_ROOTFS
	help
	  Do compress the cpio filesystem with xz.

config BR2_TARGET_ROOTFS_INITRAMFS_LZ4
	bool "lz4"
	select BR2_TARGET_ROOTFS_CPIO_LZ4 if BR2_TARGET_INITRAMFS_USE_ROOTFS
	help
	  Do compress the cpio filesystem with lz4.

endchoice

if BR2_INITRAMFS_USE_OTHER

endif # BR2_INITRAMFS_USE_OTHER

endif # BR2_TARGET_ROOTFS_INITRAMFS


config BR2_CPIO_COMPRESSION
	string
	default ""
	default "gz" if BR2_TARGET_ROOTFS_INITRAMFS_GZIP
	default "bz2" if BR2_TARGET_ROOTFS_INITRAMFS_BZIP2
	default "lzma" if BR2_TARGET_ROOTFS_INITRAMFS_LZMA
	default "lzo" if BR2_TARGET_ROOTFS_INITRAMFS_LZO
	default "xz" if BR2_TARGET_ROOTFS_INITRAMFS_XZ
	default "lz4" if BR2_TARGET_ROOTFS_INITRAMFS_LZ4


config BR2_CPIO_COMPRESSED_FILE
	string
	default "rootfs.cpio"
	default "rootfs.cpio.gz" if BR2_TARGET_ROOTFS_INITRAMFS_GZIP
	default "rootfs.cpio.bz2" if BR2_TARGET_ROOTFS_INITRAMFS_BZIP2
	default "rootfs.cpio.lzma" if BR2_TARGET_ROOTFS_INITRAMFS_LZMA
	default "rootfs.cpio.lzo" if BR2_TARGET_ROOTFS_INITRAMFS_LZO
	default "rootfs.cpio.xz" if BR2_TARGET_ROOTFS_INITRAMFS_XZ
	default "rootfs.cpio.lz4" if BR2_TARGET_ROOTFS_INITRAMFS_LZ4

comment "initramfs needs a Linux kernel to be built"
	depends on !BR2_LINUX_KERNEL
